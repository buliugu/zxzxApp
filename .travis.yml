language: android
jdk: oraclejdk8
cache: yarn
before_install:
- nvm install 6
- node --version

addons:
  apt:
    sources:
      - sourceline: 'deb https://dl.yarnpkg.com/debian/ stable main'
        key_url: 'https://dl.yarnpkg.com/debian/pubkey.gpg'
    packages:
      - yarn

install:
- yarn install



after_script:
- cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js

before_deploy:
- bash ci/.travis-android-license-bugfix.sh
- echo y | android update sdk --no-ui --all --filter ${ANDROID_EMULATOR},${ANDROID_PKGS},build-tools-23.0.1
- echo y | android update sdk -u -a -t tools
- echo y | android update sdk -u -a -t platform-tools
- echo y | android update sdk -u -a -t build-tools-23.0.1
- echo y | android update sdk -u -a -t android-23
- echo y | android update sdk -u -a -t android-25
- echo y | android update sdk -u -a -t extra-google-m2repository
- echo y | android update sdk -u -a -t extra-android-m2repository
- cd android && ./gradlew assembleRelease

notifications:
  email: false
  webhooks:
    urls:
    - https://app.zxzx119.com/
    on_success: change
    on_failure: always
    on_start: never

deploy:
  provider: releases
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  on:
    branch: master
    repo: buliugu/zxzxApp
    tags: true
